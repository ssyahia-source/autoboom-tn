<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©tails de l'annonce - AutoBoom TN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8fafc;
            color: #1f2937;
        }

        /* Navigation */
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #4b5563;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #2563eb;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
            white-space: nowrap;
        }

        .logo span {
            color: #f97316;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
            display: inline-block;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
            display: inline-block;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Conteneur principal */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
        }

        /* Grille de d√©tails */
        .details-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .details-container {
                grid-template-columns: 1fr;
            }
        }

        /* Section photos */
        .photos-section h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .photo-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .photo-item img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .photo-item img:hover {
            transform: scale(1.05);
        }

        /* Section informations */
        .info-section h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #059669;
            margin-bottom: 2rem;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .detail-item {
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .detail-item strong {
            color: #374151;
        }

        .description-section {
            margin-bottom: 2rem;
        }

        .description-section h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }

        .description-section p {
            line-height: 1.6;
            color: #4b5563;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* √âtat de chargement */
        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.5rem;
            color: #6b7280;
        }

        .error {
            text-align: center;
            padding: 3rem;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">AutoBoom<span>.tn</span></div>
            <div class="nav-links">
                <a href="index.html">Accueil</a>
                <a href="annonces.html">Annonces</a>
                <a href="deposer-annonce.html">D√©poser une annonce</a>
                <a href="concessionnaires.html">Concessionnaires</a>
                <a href="assureurs.html">Assureurs</a>
            </div>
            <a href="deposer-annonce.html" class="btn-primary">+ Vendre ma voiture</a>
        </div>
    </nav>

    <!-- Contenu principal -->
    <div class="container">
        <div id="annonce-details">
            <div class="loading">
                <div>üîÑ Chargement...</div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCPay-0BB2o9Cefuj4w5k0b70mBG2kwR4E",
            authDomain: "autoboom-tn.firebaseapp.com",
            databaseURL: "https://autoboom-tn-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "autoboom-tn",
            storageBucket: "autoboom-tn.firebasestorage.app",
            messagingSenderId: "291199404228",
            appId: "1:291199404228:web:b07c622a5f7b8bc9a4e191"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Fonction pour r√©cup√©rer l'ID depuis l'URL
        function getAnnonceIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            console.log('ID r√©cup√©r√© depuis URL:', id);
            return id;
        }

        // Fonction pour charger une annonce depuis Firebase
        async function chargerAnnonceFirebase(annonceId) {
            try {
                console.log('Chargement annonce Firebase ID:', annonceId);
                const snapshot = await database.ref('annonces/' + annonceId).once('value');
                const annonce = snapshot.val();
                console.log('Annonce charg√©e Firebase:', annonce);
                return annonce;
            } catch (error) {
                console.error('Erreur Firebase:', error);
                return null;
            }
        }

        // Fonction pour charger depuis localStorage (compatibilit√©)
        function chargerAnnonceLocale(annonceId) {
            try {
                const annonces = JSON.parse(localStorage.getItem('annonces')) || [];
                const annonce = annonces.find(a => a.id == annonceId);
                console.log('Annonce charg√©e locale:', annonce);
                return annonce;
            } catch (error) {
                console.error('Erreur localStorage:', error);
                return null;
            }
        }

        // Annonces par d√©faut (fallback)
        const annoncesParDefaut = [
            {
                id: "1",
                marque: 'Volkswagen',
                modele: 'Golf 7',
                prix: '28,500 TND',
                annee: '2018',
                kilometrage: '45,000 km',
                carburant: 'Diesel',
                transmission: 'Automatique',
                ville: 'Tunis',
                description: 'Voiture en excellent √©tat, entretien chez concessionnaire, 1 seul propri√©taire. Climatisation, GPS, toit ouvrant.',
                contact: '12 345 678',
                nom: 'Ahmed',
                date: '27/10/2024',
                photos: ['https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=600&h=400&fit=crop']
            },
            {
                id: "2",
                marque: 'Renault',
                modele: 'Clio 5',
                prix: '35,000 TND',
                annee: '2021',
                kilometrage: '25,000 km',
                carburant: 'Essence',
                transmission: 'Manuelle',
                ville: 'Sfax',
                description: 'Presque neuve, garantie constructeur encore valable. Tr√®s bon √©tat g√©n√©ral, entretien r√©gulier.',
                contact: '98 765 432',
                nom: 'Marie',
                date: '26/10/2024',
                photos: ['https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=600&h=400&fit=crop']
            }
        ];

        // Charger et afficher l'annonce
        async function chargerEtAfficherAnnonce() {
            const annonceId = getAnnonceIdFromURL();
            const container = document.getElementById('annonce-details');
            
            if (!annonceId) {
                container.innerHTML = `
                    <div class="error">
                        <div class="error-icon">‚ùå</div>
                        <h2>ID d'annonce manquant</h2>
                        <p>L'URL ne contient pas d'ID d'annonce valide.</p>
                        <a href="annonces.html" class="btn-primary" style="margin-top: 1rem;">‚Üê Retour aux annonces</a>
                    </div>
                `;
                return;
            }
            
            console.log('D√©but chargement annonce ID:', annonceId);
            
            // Essayer Firebase d'abord, puis localStorage, puis annonces par d√©faut
            let annonce = await chargerAnnonceFirebase(annonceId);
            
            if (!annonce) {
                console.log('Pas trouv√© dans Firebase, recherche locale...');
                annonce = chargerAnnonceLocale(annonceId);
            }
            
            if (!annonce) {
                console.log('Pas trouv√© localement, recherche dans annonces par d√©faut...');
                annonce = annoncesParDefaut.find(a => a.id == annonceId);
            }
            
            if (!annonce) {
                container.innerHTML = `
                    <div class="error">
                        <div class="error-icon">üîç</div>
                        <h2>Annonce non trouv√©e</h2>
                        <p>Cette annonce n'existe pas ou a √©t√© supprim√©e.</p>
                        <a href="annonces.html" class="btn-primary" style="margin-top: 1rem;">‚Üê Retour aux annonces</a>
                    </div>
                `;
                return;
            }
            
            console.log('Annonce trouv√©e:', annonce);
            
            // Garantir que les photos existent
            if (!annonce.photos || !Array.isArray(annonce.photos) || annonce.photos.length === 0) {
                annonce.photos = ['https://images.unsplash.com/photo-1549399542-7e3f8b79c341?w=600&h=400&fit=crop'];
            }
            
            // AFFICHER L'ANNONCE
            container.innerHTML = `
                <div class="details-container">
                    <!-- Photos -->
                    <div class="photos-section">
                        <h3>üì∏ Photos</h3>
                        <div class="photos-grid">
                            ${annonce.photos.map(photo => `
                                <div class="photo-item">
                                    <img src="${photo}" alt="${annonce.marque} ${annonce.modele}">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Informations -->
                    <div class="info-section">
                        <h1>${annonce.marque} ${annonce.modele}</h1>
                        <div class="price">${annonce.prix}</div>
                        
                        <div class="details-grid">
                            <div class="detail-item">
                                <strong>üìç Ville:</strong> ${annonce.ville}
                            </div>
                            <div class="detail-item">
                                <strong>üìÖ Ann√©e:</strong> ${annonce.annee}
                            </div>
                            <div class="detail-item">
                                <strong>üéØ Kilom√©trage:</strong> ${annonce.kilometrage}
                            </div>
                            <div class="detail-item">
                                <strong>‚õΩ Carburant:</strong> ${annonce.carburant}
                            </div>
                            <div class="detail-item">
                                <strong>‚öôÔ∏è Transmission:</strong> ${annonce.transmission}
                            </div>
                            <div class="detail-item">
                                <strong>üìû Contact:</strong> ${annonce.contact}
                            </div>
                            <div class="detail-item">
                                <strong>üë§ Vendeur:</strong> ${annonce.nom}
                            </div>
                            <div class="detail-item">
                                <strong>üìÖ Publi√©e le:</strong> ${annonce.date || 'Date inconnue'}
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <div class="description-section">
                            <h3>üìù Description</h3>
                            <p>${annonce.description || 'Aucune description fournie.'}</p>
                        </div>
                        
                        <!-- Boutons d'action -->
                        <div class="action-buttons">
                            <button class="btn-primary" onclick="afficherContact('${annonce.contact}', '${annonce.nom}', '${annonce.marque} ${annonce.modele}')">
                                üìû Contacter le vendeur
                            </button>
                            <button class="btn-danger" onclick="signalerAnnonce('${annonceId}')">
                                üö© Signaler cette annonce
                            </button>
                            <a href="annonces.html" class="btn-secondary">‚Üê Retour aux annonces</a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fonction pour afficher le contact
        function afficherContact(telephone, nom, vehicule) {
            alert(`üìû Contact de ${nom}\nüöó ${vehicule}\nüì± T√©l√©phone: ${telephone}\n\nAppelez ce num√©ro pour plus d'informations sur le v√©hicule`);
        }

        // Fonction pour signaler une annonce
        function signalerAnnonce(annonceId) {
            const raison = prompt('Pourquoi signalez-vous cette annonce ?\n- Photo inappropri√©e\n- Information fausse\n- Arnaque\n- Autre');
            if (raison) {
                const emailBody = `
Signalement Annonce: ${annonceId}
Raison: ${raison}
URL: ${window.location.href}

Merci de mod√©rer cette annonce.
                `.trim();
                
                window.location.href = `mailto:admin@autoboom.tn?subject=Signalement Annonce ${annonceId}&body=${encodeURIComponent(emailBody)}`;
                alert('Merci pour votre signalement ! Un email a √©t√© g√©n√©r√©.');
            }
        }

        // Charger au d√©marrage
        document.addEventListener('DOMContentLoaded', function() {
            console.log('D√©marrage chargement annonce...');
            chargerEtAfficherAnnonce();
        });
    </script>
</body>
</html>
