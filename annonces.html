<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annonces Voitures - AutoBoom TN</title>
   
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8fafc;
            color: #1f2937;
        }

        /* Navigation DESKTOP */
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            text-decoration: none;
            color: #4b5563;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #2563eb;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
            white-space: nowrap;
        }

        .logo span {
            color: #f97316;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        /* Menu Mobile Hamburger */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            color: #2563eb;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            width: 100%;
            background: white;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            flex-direction: column;
            z-index: 1001;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            display: flex;
        }
        
        .mobile-menu a {
            padding: 14px 20px;
            text-decoration: none;
            color: #4b5563;
            border-bottom: 1px solid #f1f5f9;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s;
        }
        
        .mobile-menu a:hover {
            background: #f8fafc;
        }

        /* Filtres */
        .filters {
            background: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filter-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
        }

        /* Annonces */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .annonces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .annonce-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s;
        }

        .annonce-card:hover {
            transform: translateY(-5px);
        }

        .annonce-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }

        .annonce-content {
            padding: 1.5rem;
        }

        .annonce-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }

        .annonce-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #059669;
            margin-bottom: 1rem;
        }

        .annonce-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6b7280;
            font-size: 0.875rem;
        }

        .annonce-location {
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .contact-btn {
            background: #f97316;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            width: 100%;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .contact-btn:hover {
            background: #ea580c;
        }

        .pagination {
            display: none;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            align-items: center;
        }

        .page-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .page-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .new-badge {
            background: #f97316;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .search-info {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        /* ============================================================================
           CORRECTIONS MOBILE OPTIMISÉES - MENU HAMBURGER COMPACT
           ============================================================================ */

        @media (max-width: 768px) {
            /* NAVIGATION FIXE COMPACTE */
            .navbar {
                padding: 8px 0 !important;
                position: fixed !important;
                top: 0 !important;
                width: 100% !important;
                z-index: 1000 !important;
                height: 60px !important;
                min-height: 60px !important;
                background: white !important;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
            }
            
            .nav-container {
                padding: 0 15px !important;
                height: 100% !important;
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
            }
            
            .logo {
                font-size: 1.3rem !important;
                margin: 0 !important;
            }
            
            /* CACHER LE MENU DESKTOP */
            .nav-links {
                display: none !important;
            }
            
            .btn-primary {
                display: none !important;
            }

            /* AFFICHER BOUTON HAMBURGER */
            .menu-toggle {
                display: block !important;
            }

            /* ESPACEMENT POUR LA NAV FIXE */
            body {
                padding-top: 60px !important;
                width: 100% !important;
                max-width: 100% !important;
                overflow-x: hidden !important;
                margin: 0 !important;
            }

            /* FILTRES MOBILE */
            .filters {
                padding: 1.5rem 0 !important;
                margin-bottom: 1rem !important;
                margin-top: 0 !important;
            }
            
            .filter-container {
                padding: 0 15px !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .filter-grid {
                grid-template-columns: 1fr !important;
                gap: 12px !important;
                width: 100% !important;
            }
            
            .filter-select {
                padding: 14px !important;
                font-size: 1rem !important;
                min-height: 50px !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }

            /* ANNONCES MOBILE */
            .container {
                padding: 0 15px !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .annonces-grid {
                grid-template-columns: 1fr !important;
                gap: 1.5rem !important;
                margin-bottom: 2rem !important;
                width: 100% !important;
                padding: 0 !important;
            }
            
            .annonce-card {
                margin: 0 !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            .annonce-content {
                padding: 1.25rem !important;
            }
            
            .annonce-title {
                font-size: 1.3rem !important;
            }
            
            .annonce-price {
                font-size: 1.4rem !important;
            }
            
            .contact-btn {
                padding: 14px !important;
                font-size: 1rem !important;
                min-height: 50px !important;
            }

            /* PAGINATION MOBILE */
            .pagination {
                flex-direction: column !important;
                gap: 15px !important;
                width: 100% !important;
            }
            
            .page-btn {
                padding: 12px 20px !important;
                font-size: 1rem !important;
                min-height: 50px !important;
                width: 100% !important;
            }
        }

        /* CORRECTIONS POUR TRÈS PETITS ÉCRANS */
        @media (max-width: 480px) {
            .navbar {
                height: 55px !important;
                min-height: 55px !important;
            }
            
            .logo {
                font-size: 1.2rem !important;
            }
            
            body {
                padding-top: 55px !important;
            }
            
            .mobile-menu a {
                padding: 12px 15px !important;
                font-size: 0.95rem !important;
            }
            
            .filter-select {
                min-height: 48px !important;
                padding: 12px !important;
            }
            
            .contact-btn {
                min-height: 48px !important;
                padding: 12px !important;
            }
        }

        /* OPTIMISATIONS TOUCH MOBILE */
        @media (hover: none) and (pointer: coarse) {
            .mobile-menu a, 
            .contact-btn,
            .page-btn,
            .filter-select {
                min-height: 44px !important;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">AutoBoom<span>.tn</span></div>
            <div class="nav-links">
                <a href="index.html">Accueil</a>
                <a href="annonces.html" style="color: #2563eb;">Annonces</a>
                <a href="deposer-annonce.html">Déposer une annonce</a>
                <a href="concessionnaires.html">Concessionnaires</a>
                <a href="assureurs.html">Assureurs</a>
            </div>
            <a href="deposer-annonce.html" class="btn-primary">+ Vendre ma voiture</a>
            
            <!-- Bouton Hamburger Mobile -->
            <button class="menu-toggle" onclick="toggleMobileMenu()">☰</button>
        </div>
    </nav>

    <!-- Menu Mobile -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html">🏠 Accueil</a>
        <a href="annonces.html" style="color: #2563eb; background: #f0f4ff;">🚗 Annonces</a>
        <a href="deposer-annonce.html">➕ Déposer une annonce</a>
        <a href="concessionnaires.html">🏢 Concessionnaires</a>
        <a href="assureurs.html">🛡️ Assureurs</a>
        <a href="deposer-annonce.html" style="background: #2563eb; color: white;">💰 Vendre ma voiture</a>
    </div>

    <!-- Filtres -->
    <section class="filters">
        <div class="filter-container">
            <div class="search-info" id="search-info">
                <!-- Les informations de recherche apparaîtront ici -->
            </div>
            <div class="filter-grid">
                <select class="filter-select" onchange="filtrerAnnonces()" id="filtre-marque">
                    <option value="">Toutes les marques</option>
                    <option>Toyota</option>
                    <option>Volkswagen</option>
                    <option>Mercedes-Benz</option>
                    <option>BMW</option>
                    <option>Audi</option>
                    <option>Ford</option>
                    <option>Chevrolet</option>
                    <option>Honda</option>
                    <option>Hyundai</option>
                    <option>Nissan</option>
                    <option>Kia</option>
                    <option>Peugeot</option>
                    <option>Renault</option>
                    <option>Citroën</option>
                    <option>Fiat</option>
                    <option>Jeep</option>
                    <option>Volvo</option>
                    <option>Tesla</option>
                    <option>Land Rover</option>
                    <option>Jaguar</option>
                    <option>Mazda</option>
                    <option>Mitsubishi</option>
                    <option>Suzuki</option>
                    <option>Subaru</option>
                    <option>Skoda</option>
                    <option>Seat</option>
                    <option>Opel</option>
                    <option>GMC</option>
                    <option>Cadillac</option>
                    <option>Buick</option>
                    <option>Dodge</option>
                    <option>Chrysler</option>
                    <option>Ram</option>
                    <option>Infiniti</option>
                    <option>Acura</option>
                    <option>Lexus</option>
                    <option>Porsche</option>
                    <option>Ferrari</option>
                    <option>Lamborghini</option>
                    <option>Maserati</option>
                    <option>Alfa Romeo</option>
                    <option>Bugatti</option>
                    <option>Bentley</option>
                    <option>Rolls-Royce</option>
                    <option>Aston Martin</option>
                    <option>Mini</option>
                    <option>Smart</option>
                    <option>Tata Motors</option>
                    <option>BYD</option>
                    <option>Geely</option>
                    <option>Chery</option>
                    <option>Great Wall</option>
                    <option>Dongfeng</option>
                    <option>SAIC</option>
                    <option>Haval</option>
                    <option>Lucid</option>
                    <option>Rivian</option>
                    <option>NIO</option>
                    <option>XPeng</option>
                    <option>Polestar</option>
                    <option>Dacia</option>
                    <option>Mahindra</option>
                    <option>Proton</option>
                    <option>Perodua</option>
                    <option>Genesis</option>
                    <option>Isuzu</option>
                    <option>Daewoo</option>
                    <option>Lancia</option>
                    <option>Roewe</option>
                    <option>Fisker</option>
                    <option>Koenigsegg</option>
                    <option>Pagani</option>
                    <option>McLaren</option>
                    <option>Scania</option>
                    <option>MAN</option>
                    <option>Peterbilt</option>
                    <option>Freightliner</option>
                    <option>Mack</option>
                    <option>Lincoln</option>
                    <option>Holden</option>
                    <option>Vauxhall</option>
                    <option>Saab</option>
                    <option>Maybach</option>
                    <option>DS Automobiles</option>
                    <option>Faraday Future</option>
                    <option>Aptera</option>
                    <option>VinFast</option>
                    <option>Wuling</option>
                    <option>Zotye</option>
                    <option>FAW</option>
                    <option>BAIC</option>
                    <option>JAC Motors</option>
                    <option>Hongqi</option>
                    <option>Seres</option>
                    <option>Aiways</option>
                    <option>Leapmotor</option>
                    <option>Denza</option>
                    <option>Borgward</option>
                    <option>Lotus</option>
                    <option>TVR</option>
                    <option>Caterham</option>
                    <option>Ruf</option>
                    <option>Brabus</option>
                    <option>Vector</option>
                    <option>Arrinera</option>
                    <option>De Tomaso</option>
                    <option>Pininfarina</option>
                    <option>Saleen</option>
                    <option>SSC North America</option>
                    <option>Hummer</option>
                    <option>Eagle</option>
                    <option>Plymouth</option>
                    <option>Saturn</option>
                    <option>Oldsmobile</option>
                    <option>Mercury</option>
                    <option>Hudson</option>
                    <option>Packard</option>
                    <option>Studebaker</option>
                    <option>DeLorean</option>
                    <option>Lucra</option>
                    <option>Wiesmann</option>
                    <option>Marussia</option>
                    <option>Spyker</option>
                    <option>Rimac</option>
                    <option>Zenvo</option>
                    <option>Gumpert</option>
                    <option>Vanderhall</option>
                    <option>Rezvani</option>
                    <option>Drako Motors</option>
                    <option>Hennessey</option>
                    <option>Arash</option>
                    <option>Radical</option>
                    <option>Noble</option>
                    <option>Donkervoort</option>
                    <option>Brilliance</option>
                    <option>Chang'an</option>
                    <option>JMC</option>
                    <option>ZAZ</option>
                    <option>Lifan</option>
                    <option>BAW</option>
                    <option>Wey</option>
                    <option>Ora</option>
                    <option>Hongyan</option>
                    <option>Vanderhall</option>
                    <option>Maxus</option>
                    <option>Soueast</option>
                    <option>Everus</option>
                    <option>Luxgen</option>
                    <option>Haima</option>
                    <option>Dongnan</option>
                    <option>Yulon</option>
                    <option>Kamaz</option>
                    <option>UAZ</option>
                    <option>GAZ</option>
                    <option>Lada</option>
                    <option>Zil</option>
                    <option>Derways</option>
                    <option>TagAZ</option>
                    <option>Iran Khodro</option>
                    <option>Saipa</option>
                    <option>Perana</option>
                    <option>BAIC BJEV</option>
                    <option>Leapmotor</option>
                    <option>Aiways</option>
                    <option>Seres</option>
                    <option>Hongqi</option>
                </select>
                
                <select class="filter-select" onchange="filtrerAnnonces()" id="filtre-prix">
                    <option value="">Prix max</option>
                    <option value="10000">10 000 TND</option>
                    <option value="15000">15 000 TND</option>
                    <option value="20000">20 000 TND</option>
                    <option value="30000">30 000 TND</option>  
                    <option value="40000">40 000 TND</option>
                    <option value="50000">50 000 TND</option>
                    <option value="70000">70 000 TND</option>
                    <option value="100000">100 000 TND</option>
                    <option value="150000">150 000 TND</option>
                    <option value="200000">200 000 TND</option>
                </select>
                
                <select class="filter-select" onchange="filtrerAnnonces()" id="filtre-ville">
                    <option value="">Toute la Tunisie</option>
                    <option>Tunis</option>
                    <option>Ariana</option>
                    <option>Ben Arous</option>
                    <option>Manouba</option>
                    <option>Nabeul</option>
                    <option>Zaghouan</option>
                    <option>Bizerte</option>
                    <option>Beja</option>
                    <option>Jendouba</option>
                    <option>Kef</option>
                    <option>Siliana</option>
                    <option>Kairouan</option>
                    <option>Kasserine</option>
                    <option>Sidi Bouzid</option>
                    <option>Sousse</option>
                    <option>Monastir</option>
                    <option>Mahdia</option>
                    <option>Sfax</option>
                    <option>Gabès</option>
                    <option>Medenine</option>
                    <option>Tataouine</option>
                    <option>Gafsa</option>
                    <option>Tozeur</option>
                    <option>Kebili</option>
                </select>

                <select class="filter-select" onchange="filtrerAnnonces()" id="filtre-carburant">
                    <option value="">Tous carburants</option>
                    <option>Essence</option>
                    <option>Diesel</option>
                    <option>Électrique</option>
                    <option>Hybride</option>
                </select>
            </div>
        </div>
    </section>

    <!-- Liste des annonces -->
    <div class="container">
        <h1 style="margin-bottom: 2rem; color: #1f2937;" id="titre-compteur">🎯 Chargement des annonces...</h1>
        
        <div class="annonces-grid" id="annonces-container">
            <!-- Les annonces seront chargées ici par JavaScript -->
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <button class="page-btn" id="prev-btn">← Précédent</button>
            <div id="pages-numbers" style="display: flex; gap: 0.5rem;"></div>
            <button class="page-btn" id="next-btn">Suivant →</button>
        </div>
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCPay-0BB2o9Cefuj4w5k0b70mBG2kwR4E",
            authDomain: "autoboom-tn.firebaseapp.com",
            databaseURL: "https://autoboom-tn-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "autoboom-tn",
            storageBucket: "autoboom-tn.firebasestorage.app",
            messagingSenderId: "291199404228",
            appId: "1:291199404228:web:b07c622a5f7b8bc9a4e191"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Variables globales
        let pageActuelle = 1;
        const annoncesParPage = 6;
        let toutesLesAnnonces = [];

        // Annonces par défaut
        const annoncesParDefaut = [
            {
                id: 1,
                marque: 'Volkswagen',
                modele: 'Golf 7',
                prix: '28,500 TND',
                annee: '2018',
                kilometrage: '45,000 km',
                carburant: 'Diesel',
                transmission: 'Automatique',
                ville: 'Tunis',
                description: 'Voiture en excellent état, entretien chez concessionnaire, 1 seul propriétaire',
                contact: '12 345 678',
                nom: 'Ahmed',
                date: '15/01/2024',
                hasPhotos: false
            },
            {
                id: 2,
                marque: 'Renault',
                modele: 'Clio 5',
                prix: '35,000 TND',
                annee: '2021',
                kilometrage: '25,000 km',
                carburant: 'Essence',
                transmission: 'Manuelle',
                ville: 'Sfax',
                description: 'Presque neuve, garantie constructeur encore valable',
                contact: '98 765 432',
                nom: 'Marie',
                date: '10/01/2024',
                hasPhotos: false
            },
            {
                id: 3,
                marque: 'Hyundai',
                modele: 'Tucson',
                prix: '52,000 TND',
                annee: '2020',
                kilometrage: '30,000 km',
                carburant: 'Diesel',
                transmission: 'Automatique',
                ville: 'Sousse',
                description: 'SUV familial spacieux, tous options, clim automatique',
                contact: '55 123 456',
                nom: 'Mohamed',
                date: '05/01/2024',
                hasPhotos: false
            }
        ];

        // Fonction pour le menu mobile
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('active');
        }

        // Fermer le menu en cliquant ailleurs
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (!mobileMenu.contains(event.target) && !menuToggle.contains(event.target)) {
                mobileMenu.classList.remove('active');
            }
        });

        // Fermer le menu en scrollant
        window.addEventListener('scroll', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.remove('active');
        });

        // Charger les annonces
        function chargerAnnonces() {
            console.log("🔄 Chargement depuis Firebase...");
            
            const annoncesRef = database.ref('annonces');
            
            annoncesRef.on('value', (snapshot) => {
                const data = snapshot.val();
                toutesLesAnnonces = [];
                
                // Charger depuis Firebase
                if (data) {
                    Object.keys(data).forEach(key => {
                        toutesLesAnnonces.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    console.log(`✅ ${toutesLesAnnonces.length} annonces depuis Firebase`);
                }
                
                // Ajouter annonces par défaut si vide
                if (toutesLesAnnonces.length === 0) {
                    toutesLesAnnonces = [...annoncesParDefaut];
                    console.log("📦 Utilisation des annonces par défaut");
                }
                
                // Trier par date
                toutesLesAnnonces.sort((a, b) => {
                    return new Date(b.date || 0) - new Date(a.date || 0);
                });
                
                console.log("🎯 TOTAL annonces:", toutesLesAnnonces.length);
                
                // Afficher
                afficherAnnoncesPage(1);
            });
        }

        // Afficher une page d'annonces
        function afficherAnnoncesPage(page) {
            pageActuelle = page;
            const container = document.getElementById('annonces-container');
            const titre = document.getElementById('titre-compteur');
            
            if (!toutesLesAnnonces || toutesLesAnnonces.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem;">Aucune annonce disponible</div>';
                return;
            }
            
            // Calculer les annonces de la page
            const debut = (page - 1) * annoncesParPage;
            const fin = debut + annoncesParPage;
            const annoncesPage = toutesLesAnnonces.slice(debut, fin);
            
            // Mettre à jour le titre
            const totalPages = Math.ceil(toutesLesAnnonces.length / annoncesParPage);
            titre.textContent = `🎯 ${toutesLesAnnonces.length} voitures disponibles - Page ${page}/${totalPages}`;
            
            // Générer le HTML
            container.innerHTML = annoncesPage.map(annonce => `
                <div class="annonce-card">
                    <div class="annonce-image">
                        ${annonce.photos && annonce.photos.length > 0 ? 
                            `<img src="${annonce.photos[0]}" alt="${annonce.marque} ${annonce.modele}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                            '🚗'
                        }
                    </div>
                    <div class="annonce-content">
                        <h3 class="annonce-title">
                            ${annonce.marque} ${annonce.modele}
                            ${estNouvelle(annonce.date) ? '<span class="new-badge">NOUVEAU</span>' : ''}
                        </h3>
                        <div class="annonce-price">${annonce.prix}</div>
                        <div class="annonce-details">
                            <div class="detail">📅 ${annonce.annee}</div>
                            <div class="detail">🎯 ${annonce.kilometrage}</div>
                            <div class="detail">⛽ ${annonce.carburant}</div>
                            <div class="detail">⚙️ ${annonce.transmission}</div>
                        </div>
                        <div class="annonce-location">📍 ${annonce.ville}</div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">
    📞 ${annonce.nom} • ${annonce.date}
    ${annonce.photos && annonce.photos.length > 0 ? ' • 📸 Avec photos' : ''}
</div>
<div style="font-size: 0.9rem; color: #4b5563; margin-bottom: 1rem; line-height: 1.4;">
    ${annonce.description}
</div>
<div style="display: flex; gap: 0.5rem;">
    <button class="contact-btn" onclick="contacter('${annonce.contact}', '${annonce.nom}', '${annonce.marque} ${annonce.modele}')" style="flex: 1;">
        📞 Contacter
    </button>
    <button class="contact-btn" onclick="voirDetails('${annonce.id}')" style="flex: 1; background: #2563eb;">
        🔍 Détails
    </button>
</div>
                    </div>
                </div>
            `).join('');
            
            // Afficher la pagination
            afficherPagination();
        }

        // Vérifier si une annonce est nouvelle
        function estNouvelle(dateStr) {
            if (!dateStr) return false;
            try {
                const [day, month, year] = dateStr.split('/');
                const datePublication = new Date(year, month - 1, day);
                const maintenant = new Date();
                const différence = maintenant - datePublication;
                return différence < 7 * 24 * 60 * 60 * 1000;
            } catch (e) {
                return false;
            }
        }

        // Afficher la pagination
        function afficherPagination() {
            const pagination = document.getElementById('pagination');
            const pagesNumbers = document.getElementById('pages-numbers');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            const totalPages = Math.ceil(toutesLesAnnonces.length / annoncesParPage);
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            
            // Boutons précédent/suivant
            prevBtn.disabled = pageActuelle === 1;
            prevBtn.style.opacity = pageActuelle === 1 ? '0.5' : '1';
            prevBtn.onclick = () => afficherAnnoncesPage(pageActuelle - 1);
            
            nextBtn.disabled = pageActuelle === totalPages;
            nextBtn.style.opacity = pageActuelle === totalPages ? '0.5' : '1';
            nextBtn.onclick = () => afficherAnnoncesPage(pageActuelle + 1);
            
            // Numéros de page
            pagesNumbers.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === pageActuelle ? 'active' : ''}`;
                btn.textContent = i;
                btn.onclick = () => afficherAnnoncesPage(i);
                pagesNumbers.appendChild(btn);
            }
        }

        // Fonction contact
        function contacter(telephone, nom, vehicule) {
            alert(`Contact: ${nom}\nTéléphone: ${telephone}\nVéhicule: ${vehicule}`);
        }

        function voirDetails(annonceId) {
            // Trouver l'annonce par ID
            const annonce = toutesLesAnnonces.find(a => a.id == annonceId);
            
            if (annonce) {
                const details = `
🚗 ${annonce.marque} ${annonce.modele}
💰 Prix: ${annonce.prix}
📅 Année: ${annonce.annee}
🎯 Kilométrage: ${annonce.kilometrage}
⛽ Carburant: ${annonce.carburant}
⚙️ Transmission: ${annonce.transmission}
📍 Ville: ${annonce.ville}
👤 Vendeur: ${annonce.nom}
📞 Contact: ${annonce.contact}
📅 Publié le: ${annonce.date}

📝 Description:
${annonce.description}

${annonce.photos && annonce.photos.length > 0 ? '📸 Photos disponibles' : '📷 Aucune photo'}
        `;
        
                alert(details);
            } else {
                alert("Annonce non trouvée");
            }
        }

        // Filtres
        function filtrerAnnonces() {
            const marque = document.getElementById('filtre-marque').value;
            const prixMax = document.getElementById('filtre-prix').value;
            const ville = document.getElementById('filtre-ville').value;
            const carburant = document.getElementById('filtre-carburant').value;
            
            let annoncesFiltrees = [...toutesLesAnnonces];
            
            if (marque) {
                annoncesFiltrees = annoncesFiltrees.filter(a => a.marque === marque);
            }
            if (prixMax) {
                annoncesFiltrees = annoncesFiltrees.filter(a => {
                    const prix = parseInt(a.prix.replace(/[^0-9]/g, ''));
                    return prix <= parseInt(prixMax);
                });
            }
            if (ville) {
                annoncesFiltrees = annoncesFiltrees.filter(a => a.ville === ville);
            }
            if (carburant) {
                annoncesFiltrees = annoncesFiltrees.filter(a => a.carburant === carburant);
            }
            
            toutesLesAnnonces = annoncesFiltrees;
            afficherAnnoncesPage(1);
        }

        // Réinitialiser les filtres
        function reinitialiserFiltres() {
            document.getElementById('filtre-marque').value = '';
            document.getElementById('filtre-prix').value = '';
            document.getElementById('filtre-ville').value = '';
            document.getElementById('filtre-carburant').value = '';
            
            // Recharger depuis Firebase
            chargerAnnonces();
        }

        // Démarrer au chargement
        document.addEventListener('DOMContentLoaded', function() {
            console.log("🚀 AutoBoom - Chargement des annonces");
            chargerAnnonces();
        });
    </script>
</body>
</html>
